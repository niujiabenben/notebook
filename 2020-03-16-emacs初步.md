# emacs lisp

emacs lisp是解释型的语言,  对于每一条表达式, 解释器按照如下规则去求取表达式的顺序:

1. 如果表达式前有单引号, 则返回表达式本身: `'(one two three)` 返回 `(one two three)`;

2. 如果表达式不是列表(没被括号括起来), 则认为它是一个变量: `line-length` 返回该变量对应的值;

3. 如果表达式为列表(被括号括起来了), 则认为它是一个如下三种形式中的一种: function, special form, macro. 其中列表中的第一个元素被认为是function的名字, special form的名字, 或者macro的名字. 后面的元素被认为是function, special form, 或者macro的参数.

4. function对应其他语言中的函数, special form对应其他语言中的控制结构, marco为可以生成其他代码的语句, 相当于c语言中的宏.

对于一个名字, 解释器通过其位置来确定它是变量还是函数, 所以一个名字可以同时拥有一个值和一个函数体:

```emacs-lisp
(setq count 1)
(defun count ())

;;; 在*scratch* buffer运行
count    ; 输出 1

(count)  ; 输出 nil
```

### special forms & macros

```emacs-lisp
;;; while 循环, 返回值永远为nil
(while true-or-false-test
  body...)

;;; cond, 相当于if elif else
(cond
  (first-true-or-false-test first-consequent)

  (second-true-or-false-test second-consequent)

  (third-true-or-false-test third-consequent)

  (t default-consequent))

;;; dolist macro, 对一个列表进行循环, 相当于 `for element in list`
(defun reverse-list-with-dolist (list)

  (let (value) ; make sure list starts empty

  (dolist (element list value)

  (setq value (cons element value)))))

;;; dotimes macro, 对数字进行循环, 相当于 `for i in range(MAX)`
(defun sum-from-1-to-n (MAX)
  (let ((value 0))
    (dotimes (num MAX value)
      (setq value (+ num value)))))

;;; 递归: 展开方向由外向内, 求值方向由内向外
(defun sum-from-1-to-n (MAX)
  (cond ((= MAX 0) 0)
        (t (+ MAX (sum-from-1-to-n (- MAX 1))))))

;;; 尾递归: 将中间值当成额外参数传递, 调用时SUM要给初始值0
(defun sum-from-1-to-n (MAX SUM)
  (cond ((= MAX 0) SUM)
        (t (sum-from-1-to-n (- MAX 1) (+ SUM MAX)))))

;;; save-excursion: 保留当前buffer和point的位置
;;; save-restriction: 保留当前narrowing的设置
;;; 两者同时存在的时候, 需要按照如下方式设置
(save-excursion
  (save-restriction
    body...))
```

### small tips

* helm-all-mark-rings: 显示所有的mark ring, 目前绑定在: `C-c h space`.

* helm-occur-from-isearch: 查找的时候, 这个命令显示所有匹配的行, 目前绑定在: `C-o`

* sh-backslash-region : 写shell脚本的时候, 用这个命令在每一行后面加反斜杠, 目前绑定到`C-c C-'`.

参考

1. [Emacs Lisp的教程-水木社区](http://smacs.github.io/elisp/)
2. [ElispCookbook (这里有很好的例子)](https://www.emacswiki.org/emacs/ElispCookbook)


